---
title: ã€Šæ ‘è“æ´¾å®¶åº­æœåŠ¡å™¨æ­å»ºæŒ‡å—ã€‹ç¬¬äºŒæœŸï¼šç½‘ç›˜ç•Œçš„æœªæ¥ç§‘æŠ€ï¼Œæ–°å¢smbæœåŠ¡å¹¶å®Œæˆå†…ç½‘ç©¿é€ï¼Œå®ç°æ‰€æœ‰è®¾å¤‡å…±äº«æ–‡ä»¶ / ã€ŠUse Piã€‹ Issue 2 The Future Technology of the Network Disk Industry, Adding SMB Service and Completing Intranet Penetration, Realizing File Sharing for All Devices
categories:
- æ ‘è“æ´¾ä¸åƒç° / Use Pi
---


ç»è¿‡ä¸ŠæœŸçš„æ“ä½œï¼Œæˆ‘ä»¬å·²ç»æ­å»ºäº†å¸¦å†…ç½‘ç©¿é€çš„æ ‘è“æ´¾å®¶ç”¨æœåŠ¡å™¨ï¼›`ã€Šæ ‘è“æ´¾å®¶åº­æœåŠ¡å™¨æ­å»ºæŒ‡å—ã€‹åˆ·Ubuntu Server 20.04ï¼Œç»‘å®šå…¬ç½‘åŸŸåï¼Œå¯¹å…¬ç½‘æä¾›httpæœåŠ¡ï¼ŒSSHç™»å½•æœåŠ¡  https://v2fy.com/p/2021-10-01-pi-server-1633066843000/`

ğŸŒˆAfter the operation of the last issue, we have built a Raspberry Pi home server with intranet penetration; "Raspberry Pi Home Server Building Guide" Brush Ubuntu Server 20.04, bind public domain name, provide http service to the public network, SSH login service  https://v2fy.com/p/2021-10-01-pi-server-1633066843000/

æœ¬æœŸzhaooleeå°†ä¸ºæ ‘è“æ´¾æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œé€šè¿‡å¾€æ ‘è“æ´¾æŒ‚è½½å¤§å®¹é‡ç¡¬ç›˜ï¼Œå®ç°å±€åŸŸç½‘å†…çš„æ‰€æœ‰è®¾å¤‡çš„æ–‡ä»¶å…±äº«ï¼Œä¹Ÿå°±æ˜¯äººä»¬å¸¸è¯´çš„smbæœåŠ¡å™¨ï¼›

ğŸŒˆIn this issue, zhaoolee will add new functions to the Raspberry Pi. By mounting a large-capacity hard disk to the Raspberry Pi, it can realize file sharing of all devices in the local area network, which is commonly known as the smb server;

smbå±€åŸŸç½‘æœåŠ¡å™¨æ­å»ºå®Œæˆåï¼Œæˆ‘è¿˜åšäº†å†…ç½‘ç©¿é€çš„é…ç½®ï¼Œå¯ä»¥åœ¨å…¬ç½‘ä»»ä½•ä¸€å°è®¡ç®—æœºï¼Œé€šè¿‡è´¦å·å¯†ç è®¿é—®å®¶ä¸­çš„æ ‘è“æ´¾æŒ‚è½½çš„å¤§å®¹é‡ç¡¬ç›˜~

ğŸŒˆAfter the smb LAN server is set up, I also made the configuration of intranet penetration. Any computer on the public network can access the large-capacity hard disk mounted on the Raspberry Pi at home through the account and password~

ä¸ºä»€ä¹ˆé€‰ç”¨smbåè®®ï¼Ÿ

ğŸŒˆWhy choose smb protocol?

smbçš„ä¼˜ç‚¹æ˜¯å…¼å®¹æ€§å¥½ï¼Œåœ¨å„å¹³å°è·å¾—äº†å¹¿æ³›æ”¯æŒï¼ŒåŒ…æ‹¬ Windowsã€Linuxã€macOS ç­‰å„ç³»ç»ŸæŒ‚è½½è®¿é—®éƒ½å¾ˆæ–¹ä¾¿ã€‚å¦å¤– smbä¹Ÿæ˜¯å„ç§ç”µè§†ã€ç”µè§†ç›’å­é»˜è®¤æ”¯æŒçš„åè®®ï¼Œå¯ä»¥é€šè¿‡ smb è¿œç¨‹æ’­æ”¾ç”µå½±ã€éŸ³ä¹å’Œå›¾ç‰‡ã€‚

ğŸŒˆThe advantage of smb is good compatibility. It has gained wide support on various platforms, including Windows, Linux, macOS and other systems, which are very convenient for mounting and accessing. In addition, smb is also the default protocol supported by various TVs and TV boxes, and movies, music and pictures can be played remotely through smb.



## åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ / Create a Directory

```
sudo mkdir /opt/smb
sudo chmod -R 777 /opt/smb
```

## å®‰è£…smbæœåŠ¡ / Install smb Service

```
sudo apt update
sudo apt install samba -y
```

## åˆ›å»ºsmbå¯†ç æ–‡ä»¶ / Create smb Password File

```
sudo touch /etc/samba/smbpasswd
```

## æ·»åŠ ç”¨æˆ·å¹¶è®¾ç½®å¯†ç  / Add User and Set Password

```
sudo smbpasswd -a ubuntu
```

![smb add new user / æ·»åŠ smbæ–°ç”¨æˆ·](https://cdn.fangyuanxiaozhan.com/assets/1633231700005ZaYbhXr3.png)

å¦‚æœéœ€è¦æ›´æ”¹å¯†ç ï¼Œå†æ¬¡æ‰§è¡Œ  `sudo smbpasswd -a ubuntu` å³å¯ï¼›

ğŸŒˆIf you need to change the password, just run `sudo smbpasswd -a ubuntu` again;

è¿™é‡Œçš„ubuntuæ˜¯ ç”¨æˆ·åï¼Œè¯·æŒ‰ç…§å®é™…æƒ…å†µï¼Œæ›¿æ¢ä¸ºè‡ªå·±çš„ç”¨æˆ·åï¼›

ğŸŒˆHere, ubuntu is the username. Please replace it with your own username according to the actual situation;

## åœ¨`/etc/samba/smb.conf` ä¸­æ·»åŠ å¦‚ä¸‹é…ç½® / Add the Following Configuration in `/etc/samba/smb.conf`


```
[ubuntu]
   comment = ubuntu
   path = /opt/smb
   writable = yes
   valid user = ubuntu
   available = yes
   create mask = 0777
   directory mask = 0777
   public = yes
```

![åº•éƒ¨æ·»åŠ  / Add at the Bottom](https://cdn.fangyuanxiaozhan.com/assets/1633231699718xpXAsbYe.png)

## é‡å¯smbæœåŠ¡ / Restart smb Service

```
sudo /etc/init.d/smbd restart
```
![é‡å¯æœåŠ¡ / Restart Service](https://cdn.fangyuanxiaozhan.com/assets/1633231699836YEkknFt4.png)


## WindowsæŒ‚è½½ä½¿ç”¨smb / Windows Mounts and Uses smb


- æ‰“å¼€æ§åˆ¶é¢æ¿

- ğŸŒˆOpen Control Panel


![æ‰“å¼€æ§åˆ¶é¢æ¿ / Open Control Panel](https://cdn.fangyuanxiaozhan.com/assets/1633231699673YYReX1nA.png)


- é€‰æ‹©ç¨‹åº

- ğŸŒˆSelect Program

![é€‰æ‹©ç¨‹åº / Select Program](https://cdn.fangyuanxiaozhan.com/assets/1633231700392cRHYpm1E.png)


- å¯ç”¨WindowsåŠŸèƒ½

- ğŸŒˆEnable Windows Features

![å¯ç”¨WindowsåŠŸèƒ½ / Enable Windows Features](https://cdn.fangyuanxiaozhan.com/assets/1633231699882mB2MfDCE.png)

- å¯ç”¨SMB 1.0

- ğŸŒˆEnable SMB 1.0

![å¯ç”¨SMB 1.0 / Enable SMB 1.0](https://cdn.fangyuanxiaozhan.com/assets/1633231701656S4Y0zRHf.png)

- é‡å¯ç”Ÿæ•ˆ

- ğŸŒˆRestart to take effect

![é‡å¯ç”Ÿæ•ˆ / Restart to take effect](https://cdn.fangyuanxiaozhan.com/assets/1633231700393QjWSKQwm.png)


- æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨

- ğŸŒˆMap Network Drive

![æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨ / Map Network Drive](https://cdn.fangyuanxiaozhan.com/assets/1633231699985rFiEz1BG.png)

- å®Œæˆ

- ğŸŒˆCompleted

![å®Œæˆ / Completed](https://cdn.fangyuanxiaozhan.com/assets/1633231700452TPmjd5Tr.png)

- è¾“å…¥å¯†ç 

- ğŸŒˆEnter Password

![è¾“å…¥å¯†ç  / Enter Password](https://cdn.fangyuanxiaozhan.com/assets/16332316998378AmyhChk.png)

- æŒ‚è½½æˆåŠŸ

- ğŸŒˆMount Successful

![æŒ‚è½½æˆåŠŸ / Mount Successful](https://cdn.fangyuanxiaozhan.com/assets/1633231700038YHf2Yw4F.png)

## åœ¨Macä¸ŠæŒ‚è½½ä½¿ç”¨smb / Mounting SMB on Mac

- è¿æ¥æœåŠ¡å™¨

- ğŸŒˆConnect to Server

![è¿æ¥æœåŠ¡å™¨ / Connect to Server](https://cdn.fangyuanxiaozhan.com/assets/1633231699988RrrYMb1a.png)


-  è¾“å…¥æœåŠ¡å™¨ipå’Œæ–‡ä»¶å¤¹åç§°

- ğŸŒˆEnter server IP and folder name

```
smb://192.168.50.220/ubuntu
```

![è¾“å…¥æœåŠ¡å™¨ipå’Œæ–‡ä»¶å¤¹åç§° / Enter server IP and folder name](https://cdn.fangyuanxiaozhan.com/assets/163323169994771XwH3je.png)

- ç‚¹å‡»è¿æ¥

- ğŸŒˆClick Connect

![ç‚¹å‡»è¿æ¥ / Click Connect](https://cdn.fangyuanxiaozhan.com/assets/1633231699693hAmSdRbs.png)

- è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç™»å½•

- ğŸŒˆEnter username and password, log in

![è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç™»å½• / Enter username and password, log in](https://cdn.fangyuanxiaozhan.com/assets/1633231700022xNbYYBYc.png)

- ç™»å½•æˆåŠŸ

- ğŸŒˆLogin Successful

![ç™»å½•æˆåŠŸ / Login Successful](https://cdn.fangyuanxiaozhan.com/assets/1633231701092NpXERPA7.png)

- ä¸ºäº†æµ‹è¯•ï¼Œå¾€é‡Œé¢æ‹·è´å‡ ä¸ªæ–‡ä»¶ï¼Œå®Œå…¨æ²¡é—®é¢˜ï¼Œ å¤§åŠŸå‘Šæˆï¼

- ğŸŒˆFor testing, copy a few files into it, no problem at all, job well done!

![ä¸ºäº†æµ‹è¯•ï¼Œå¾€é‡Œé¢æ‹·è´å‡ ä¸ªæ–‡ä»¶ï¼Œå®Œå…¨æ²¡é—®é¢˜ï¼Œ å¤§åŠŸå‘Šæˆ / For testing, copy a few files into it, no problem at all, job well done!](https://cdn.fangyuanxiaozhan.com/assets/1633231699785zk4r43AK.png)
## smbç©ºé—´æ‰©å®¹ / SMB Space Expansion

æˆ‘æœ‰ä¸€ä¸ª1TBçš„å¤§ç¡¬ç›˜ï¼Œæ‰“ç®—ä½œä¸ºsmbçš„å­˜å‚¨ç©ºé—´ï¼›

é¦–å…ˆè¦ä¿è¯æ ‘è“æ´¾çš„ä¾›ç”µï¼Œä¾›ç”µç”µæºéœ€è¦è¾¾åˆ°5V 3000æ¯«å®‰ï¼Œæ‰èƒ½ä¿è¯é€šè¿‡USBæ¥å…¥å¤§å®¹é‡ç¡¬ç›˜åï¼Œæ ‘è“æ´¾ä¸ä¼šæ­»æœºã€‚

ğŸŒˆI have a 1TB hard drive that I plan to use as storage space for smb;

Firstly, we need to ensure the power supply of the Raspberry Pi, the power supply needs to reach 5V 3000mA, to ensure that the Raspberry Pi will not crash after the high-capacity hard drive is connected through USB.

- åœ¨`/opt/smb/` ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ `1tb`ï¼Œ ä½œä¸ºæŒ‚è½½ç‚¹

- ğŸŒˆCreate a new folder `1tb` under `/opt/smb/` as the mount point

```
sudo mkdir  /opt/smb/1tb
sudo chmod 777 -R  /opt/smb/1tb
```

- æ¥å…¥ç¡¬ç›˜ï¼ŒæŸ¥çœ‹ç¡¬ç›˜æ˜¯å¦æ¥å…¥æˆåŠŸ

- ğŸŒˆConnect the hard drive and check if the hard drive is successfully connected

```
sudo fdisk -l
```

![æŸ¥çœ‹ç¡¬ç›˜æ˜¯å¦æ¥å…¥æˆåŠŸ / Check if the hard drive is successfully connected](https://cdn.fangyuanxiaozhan.com/assets/16332317012478HZkGx04.png)

å¯ä»¥çœ‹åˆ°è®¾å¤‡æŒ‚è½½çš„ä½ç½®ä¸º `/dev/sda1`

ğŸŒˆYou can see that the device is mounted at `/dev/sda1`

- æŒ‚è½½ç¡¬ç›˜

- ğŸŒˆMount the hard drive

```
sudo mount /dev/sda1 /opt/smb/1tb
sudo chmod 777 -R  /opt/smb/1tb
```

- æŸ¥çœ‹æŒ‚è½½æ•ˆæœ

- ğŸŒˆCheck the mount effect

å¯ä»¥é€šè¿‡1tbæ–‡ä»¶å¤¹å¢åˆ æ”¹æŸ¥æ–°ç¡¬ç›˜çš„å†…å®¹

ğŸŒˆYou can add, delete, modify and check the new hard drive content through the 1tb folder

![å¯ä»¥é€šè¿‡1tbæ–‡ä»¶å¤¹å¢åˆ æ”¹æŸ¥æ–°ç¡¬ç›˜çš„å†…å®¹ / You can add, delete, modify and check the new hard drive content through the 1tb folder](https://cdn.fangyuanxiaozhan.com/assets/16332317005231jcwrKDb.png)

![Mac / Mac](https://cdn.fangyuanxiaozhan.com/assets/1633231699958X1Nd0RcP.png)

## å¦‚ä½•æŠŠsmbæœåŠ¡å¼€æ”¾çš„å…¬ç½‘ï¼Ÿ / How to open SMB service to the public network?

smbæœåŠ¡åœ¨æ ‘è“æ´¾æä¾›æœåŠ¡å™¨çš„ç«¯å£ä¸º445ï¼Œæœ€ä½³çš„æ–¹æ¡ˆå½“ç„¶æ˜¯æŠŠæ ‘è“æ´¾çš„445ç«¯å£æ˜ å°„åˆ°å…¬ç½‘æœåŠ¡å™¨çš„445ç«¯å£ï¼Œä½†æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œé˜¿é‡Œäº‘å¯¹445ç«¯å£åšäº†é™åˆ¶ï¼Œäºæ˜¯æˆ‘åªå¥½æŠŠæ ‘è“æ´¾çš„445ç«¯å£æ˜ å°„åˆ°äº†å…¬ç½‘æœåŠ¡å™¨çš„44501ç«¯å£ã€‚

ğŸŒˆThe SMB service provides the server port on the Raspberry Pi as 445. The best solution is of course to map the Raspberry Pi's 445 port to the public network server's 445 port. But I am using Alibaba Cloud server, and Alibaba Cloud has restricted the 445 port, so I had to map the Raspberry Pi's 445 port to the public network server's 44501 port.

é…ç½®ä¹Ÿå¾ˆç®€å•ï¼ˆå¦‚æœä¸çŸ¥é“frpçš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œè¯·æŸ¥çœ‹ä¸Šä¸€æœŸï¼Œæœ¬æ–‡å¼€å¤´æœ‰ä¸Šä¸€æœŸçš„ç½‘å€ï¼‰



ğŸŒˆThe configuration is also very simple (if you don't know what the client configuration file of frp is, please check the last issue, the URL of the last issue is at the beginning of this article)

![å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ / Client Configuration File](https://cdn.fangyuanxiaozhan.com/assets/16332317006468SMH8s0C.png)

```
[smb-frp-v2fy-com-44501]
type = tcp
local_ip = 127.0.0.1
local_port = 445
remote_port = 44501
```

- è¿æ¥å…¬ç½‘æ˜ å°„smbæœåŠ¡

- ğŸŒˆConnect to the public network mapped SMB service

![è¿æ¥å…¬ç½‘æ˜ å°„smbæœåŠ¡ / Connect to the public network mapped SMB service](https://cdn.fangyuanxiaozhan.com/assets/16332316997830KA55BE2.png)

- æ³¨æ„å†™44501ç«¯å£

- ğŸŒˆNote to write 44501 port

![æ³¨æ„å†™44501ç«¯å£ / Note to write 44501 port](https://cdn.fangyuanxiaozhan.com/assets/1633231700328itm5seaS.png)

- è¿æ¥æˆåŠŸ

- ğŸŒˆConnection Successful

![è¿æ¥æˆåŠŸ / Connection Successful](https://cdn.fangyuanxiaozhan.com/assets/1633231700851thm2Hjda.png)

åšå®Œ44501ç«¯å£æ˜ å°„åå‘ç°Windowsä¸€ä¸ªå‘çˆ¹çš„æ“ä½œï¼ŒWindowsä¸èƒ½è‡ªå®šä¹‰ç«¯å£ï¼Œä¹Ÿå°±æ˜¯åªèƒ½ç”¨445ç«¯å£...

ğŸŒˆAfter completing the 44501 port mapping, I found a pitfall of Windows, Windows cannot customize the port, that is, it can only use the 445 port...

```bash
netsh interface portproxy add v4tov4 listenaddress=127.0.0.1 listenport=445 connectaddress=frp.v2fy.com connectport=44501

netsh interface portproxy show all
```
- ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œcmdå‘½ä»¤æå‡ç¬¦, è¿è¡Œä»¥ä¸‹å‘½ä»¤

- ğŸŒˆRun the following command as an administrator in the CMD command prompt

![å‘½ä»¤æå‡ç¬¦ / Command Prompt](https://cdn.fangyuanxiaozhan.com/assets/1633231700008MPYaFPZP.png)


![cmdæ‰§è¡Œ / CMD Execution](https://cdn.fangyuanxiaozhan.com/assets/1633231700356je3YJ7yT.png)


![æ˜ å°„å†™æ³• / Mapping Syntax](https://cdn.fangyuanxiaozhan.com/assets/1633231699843rAmNzE4p.png)


![445åˆ°44501 / 445 to 44501](https://cdn.fangyuanxiaozhan.com/assets/1633231700327eMydp0NB.png)


![é…ç½®æˆåŠŸ / Configuration Successful](https://cdn.fangyuanxiaozhan.com/assets/1633231699732yzaCbtJR.png)


è‡³æ­¤ï¼Œé…ç½®æˆåŠŸï¼

ğŸŒˆAt this point, the configuration is successful!

## å°ç»“ / Summary

æœ‰äº†smbæœåŠ¡ï¼Œè®¾å¤‡ä¹‹é—´çš„æ–‡ä»¶å…±äº«ï¼Œå˜å¾—éå¸¸ç®€å•ï¼åœ¨2021å¹´ï¼Œå›½å†…æ‰€æœ‰çš„ç½‘ç›˜èµ„æºå‡ ä¹éƒ½å—åˆ°å®¡æŸ¥ï¼Œç™¾åº¦ç½‘ç›˜æ›´æ˜¯èƒ¡ä¹±å°ç¦çš„ï¼Œåˆä¸ç»™ç”¨æˆ·ä»»ä½•è§£é‡Šï¼Œè€Œé€šè¿‡æ ‘è“æ´¾å†…ç½‘ç©¿é€æ­å»ºçš„smbæœåŠ¡ï¼Œæ”¯æŒå¹¿æ³›ï¼Œæ— éœ€å®‰è£…å®¢æˆ·ç«¯ï¼Œæœ‰è´¦å·å¯†ç æ§åˆ¶ï¼Œå ªç§°ç½‘ç›˜ç•Œçš„æœªæ¥ç§‘æŠ€ã€‚

ğŸŒˆWith the SMB service, file sharing between devices becomes very simple! In 2021, almost all network disk resources in China are subject to scrutiny, and Baidu network disk is even randomly banned without giving users any explanation. However, the SMB service built by Raspberry Pi intranet penetration is widely supported, does not require the installation of a client, and has account password control, which can be called the future technology of the network disk industry.


---
title: ã€Šæ ‘è“æ´¾ä¸åƒç°ã€‹ç¬¬äºŒåä¸€æœŸï¼šéƒ¨ç½²å¼€æºè¿œç¨‹æ¡Œé¢æœåŠ¡rustdesk,å†…ç½‘ä¸æ»‘,å¤–ç½‘æµç•…æ§åˆ¶Windows,macOS,Linuxä¸»æœº / ã€ŠUse Piã€‹Issue 21 Deploy the open-source remote desktop service rustdesk, smoothly control Windows, macOS, Linux hosts in the intranet and fluently in the extranet
categories:
- æ ‘è“æ´¾ä¸åƒç° / Use Pi
---

å‰æ®µæ—¶é—´, æœ‰ä¸€å°è€å¼MacBook Proè¢«æˆ‘æ”¹é€ æˆäº†å½±è§†èµ„æºè§£ç ä¸»æœº, [ã€Šæ ‘è“æ´¾ä¸åƒç°ã€‹ç¬¬åä¸ƒæœŸï¼šæ ‘è“æ´¾é…åˆæ€§èƒ½æ›´å¥½çš„é—²ç½®ç¬”è®°æœ¬æ­å»ºå¼€æºå…è´¹jellyfinç§äººå½±é™¢](https://v2fy.com/p/2023-06-10-jellyfin-1686388142000/) , æˆ‘æƒ³é€šè¿‡è¿œç¨‹æ¡Œé¢è®¿é—®è¿™å°MacBook Pro, å‘ç°Macè™½ç„¶åŸç”Ÿæ”¯æŒVNCè¿æ¥ï¼Œä½†å®é™…ç”¨èµ·æ¥ç»å¸¸ç”»é¢æ’•è£‚ï¼Œäºæ˜¯æˆ‘æ‰¾äº†ä¸€æ¬¾å¼€æºçš„è¿œç¨‹æ¡Œé¢ç¨‹åºrustdesk, å°†å…¶æœåŠ¡éƒ¨ç½²åœ¨æ ‘è“æ´¾ä¸Šï¼Œå®ç°å±€åŸŸç½‘è®¾å¤‡ä¸æ»‘è®¿é—®, å¤–ç½‘è®¾å¤‡ä¹Ÿå¯ä»¥é€šè¿‡å†…ç½‘ç©¿é€ç›´æ¥è®¿é—®macOS

ğŸŒˆA while ago, I transformed an old MacBook Pro into a video resource decoding host, [ã€ŠRaspberry Pi Home Server Building Guideã€‹Issue 17: Raspberry Pi combined with a better performing idle laptop to build an open-source free jellyfin private cinema](https://v2fy.com/p/2023-06-10-jellyfin-1686388142000/). I wanted to access this MacBook Pro via a remote desktop. Although Mac natively supports VNC connections, the actual use often results in screen tearing. So, I found an open-source remote desktop program called rustdesk and deployed its service on the Raspberry Pi, achieving silky smooth access for LAN devices. Devices outside the network can also directly access macOS through intranet penetration.

rustdeskçš„Githubå¼€æºåœ°å€ https://github.com/rustdesk/rustdesk

ğŸŒˆThe open-source Github address for rustdesk: https://github.com/rustdesk/rustdesk

## rustdeskçš„ä¼˜åŠ¿ / Advantages of rustdesk

- å¼€æº, æ”¯æŒç§æœ‰åŒ–éƒ¨ç½²

- ğŸŒˆOpen source, supports private deployment

- ä¸é™åˆ¶è¿æ¥æ•°é‡

- ğŸŒˆNo limit on the number of connections

- æ”¯æŒWindows, macOS, Linux, ä¸€å¥—æ–¹æ¡ˆæå®šè¿œç¨‹æ§åˆ¶

- ğŸŒˆSupports Windows, macOS, Linux, one solution for remote control

- é€šè¿‡å†…ç½‘æ˜ å°„çš„æ–¹æ¡ˆ, è®©ä½ éšæ—¶éšåœ°è¿œç¨‹æ§åˆ¶å†…ç½‘è®¾å¤‡

- ğŸŒˆThrough the intranet mapping solution, you can remotely control intranet devices anytime, anywhere

- å†…ç½‘è®¿é—®ä¸æ»‘æµç•…, è‡ªåŠ¨åˆ‡æ¢å†…å¤–ç½‘æµé‡

- ğŸŒˆIntranet access is silky smooth, automatically switches between intranet and extranet traffic


## åœ¨æ ‘è“æ´¾éƒ¨ç½²rustdeskï¼Œå®ç°å±€åŸŸç½‘Windowsæ§åˆ¶macOS / Deploy rustdesk on Raspberry Pi to achieve LAN Windows control macOS

```
# åˆ›å»ºæŒ‚è½½ç›®å½• / Creating Mount Directory
mkdir -p /opt/rustdesk
chmod 755 -R /opt/rustdesk
# åˆ›å»ºç”¨äºå­˜æ”¾docker-compose.ymlçš„ç›®å½• / Creating Directory for docker-compose.yml
mkdir -p /opt/rustdesk-docker-compose-yml
chmod 755 -R /opt/rustdesk-docker-compose-yml
# åˆ›å»ºdocker-compose.yml / Creating docker-compose.yml
touch /opt/rustdesk-docker-compose-yml/docker-compose.yml 
```


åœ¨`docker-compose.yml`ä¸­å†™å…¥é…ç½®å†…å®¹

ğŸŒˆWrite the configuration content in `docker-compose.yml`

```git
cat << 'EOF' > /opt/rustdesk-docker-compose-yml/docker-compose.yml
version: '3'

networks:
  rustdesk-net:
    external: false

services:
  hbbs:
    container_name: hbbs
    ports:
      - 21115:21115
      - 21116:21116
      - 21116:21116/udp
      - 21118:21118
    image: rustdesk/rustdesk-server:latest
    command: hbbs -r rustdesk.example.com:21117
    volumes:
      - /opt/rustdesk:/root
    networks:
      - rustdesk-net
    depends_on:
      - hbbr
    restart: unless-stopped

  hbbr:
    container_name: hbbr
    ports:
      - 21117:21117
      - 21119:21119
    image: rustdesk/rustdesk-server:latest
    command: hbbr
    volumes:
      - /opt/rustdesk:/root
    networks:
      - rustdesk-net
    restart: unless-stopped
EOF
```

- å¯åŠ¨æœåŠ¡ 
- ğŸŒˆStart the service

```
cd /opt/rustdesk-docker-compose-yml/
sudo docker-compose up -d
```

![image-20230912100942170](https://cdn.fangyuanxiaozhan.com/assets/1694484583353NyeQczMW.png)

æˆ‘çš„æ ‘è“æ´¾å±€åŸŸç½‘IPä¸º`192.168.50.10`, å°†`192.168.50.10` å¡«å…¥rustdesk çš„å®¢æˆ·ç«¯å³å¯ï¼ˆå‘èµ·ç«¯å’Œè¢«æ§ç«¯éƒ½éœ€è¦ä¸‹è½½å®‰è£…rustdeskå®¢æˆ·ç«¯ï¼Œå¹¶å¡«å†™å¥½ID Serverï¼‰, rustdeskå®¢æˆ·ç«¯ä¸‹è½½åœ°å€ https://github.com/rustdesk/rustdesk/releases

ğŸŒˆMy Raspberry Pi LAN IP is `192.168.50.10`. Fill in `192.168.50.10` in the rustdesk client (both the initiating end and the controlled end need to download and install the rustdesk client, and fill in the ID Server). The download address of the rustdesk client is https://github.com/rustdesk/rustdesk/releases

![image-20230912101426079](https://cdn.fangyuanxiaozhan.com/assets/1694484866814RTGS03DK.png)

å®¢æˆ·ç«¯ä¿å­˜åï¼Œä¼šæ˜¾ç¤ºé…ç½®æˆåŠŸ

ğŸŒˆAfter the client is saved, it will show that the configuration is successful

![image-20230912101459339](https://cdn.fangyuanxiaozhan.com/assets/1694484900078DRZ176RF.png)

é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ ‘è“æ´¾è¿è¡Œçš„rustdeskæœåŠ¡ï¼Œè¿›è¡Œå±€åŸŸç½‘å†…è®¾å¤‡ç›¸äº’è¿œç¨‹æ§åˆ¶äº†

ğŸŒˆAfter the configuration is complete, we can use the rustdesk service running on the Raspberry Pi to remotely control devices within the LAN

![image-20230912102038004](https://cdn.fangyuanxiaozhan.com/assets/1694485238684pnTW0zzc.png)

è¢«æ§åˆ¶ä¸»æœºçš„IDä¸ä¼šå˜ï¼ˆé™¤éç”¨æˆ·ä¸»åŠ¨æ”¹ï¼‰ï¼Œä½†å¯†ç ç»å¸¸ä¼šéšæœºå˜åŒ–ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å›ºå®šå¯†ç ï¼Œå¯ä»¥ç›´æ¥æŒ‰ç…§ä¸‹å›¾è¿›è¡Œè®¾ç½®

ğŸŒˆThe ID of the controlled host will not change (unless the user actively changes it), but the password will often change randomly. If you want to use a fixed password, you can set it directly according to the following figure

![image-20230912102601840](https://cdn.fangyuanxiaozhan.com/assets/1694485563086fZ6EYi1J.png)

![image-20230912102727070](https://cdn.fangyuanxiaozhan.com/assets/1694485647831XMhiM5Bh.png)

æ˜¾ç¤ºæ–¹é¢å¯ä»¥è‡ªå®šä¹‰è®¾ç½®ï¼Œå±€åŸŸç½‘çš„å»¶è¿Ÿå¯ä»¥åˆ°5ms, ç”¨Windowsæ§åˆ¶macOSéå¸¸é¡ºæ»‘è·Ÿæ‰‹

ğŸŒˆThe display can be customized. The delay of the LAN can be as low as 5ms, and it is very smooth to control macOS with Windows

![image-20230912103259426](https://cdn.fangyuanxiaozhan.com/assets/1694485980398sQShxFwa.png)

é‡åˆ°çš„ä¸€ä¸ªå°å‘ï¼šå¦‚æœMacBookä¸å¤–æ¥æ˜¾ç¤ºå™¨åˆä¸Šç›–å­ï¼Œrustdeskç»å¸¸ä¼šå‡ åç§’å°±è‡ªåŠ¨æ–­å¼€ï¼Œå¦‚æœä½ ä¹Ÿæ˜¯æƒ³æ§åˆ¶MacBookï¼Œè¯·ä¸è¦åˆä¸Šç›–å­ã€‚

ğŸŒˆA small pitfall I encountered: If the MacBook does not connect to an external display and closes the lid, rustdesk will often disconnect automatically in a few seconds. If you also want to control the MacBook, please do not close the lid.


## è®©å®¶é‡Œæ ‘è“æ´¾çš„rustdeskæœåŠ¡æ”¯æŒå¤–ç½‘è®¿é—® / Make the Rustdesk Service on the Raspberry Pi at Home Support External Network Access

å¤–ç½‘è®¿é—®å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œç”¨frpåšå‡ ä¸ªç«¯å£æ˜ å°„å°±å¥½äº†

ğŸŒˆAccessing from the external network is actually very simple, just use frp to do a few port mappings.

![image-20230912111138990](https://cdn.fangyuanxiaozhan.com/assets/1694488300187hfGn57Qt.png)

- åœ¨æ ‘è“æ´¾çš„frpc.iniæ–‡ä»¶ä¸­æ–°å¢ä»¥ä¸‹é…ç½®ï¼Œé‡å¯frpcå³å¯

- ğŸŒˆAdd the following configuration in the frpc.ini file of the Raspberry Pi, and restart frpc.

```
[rustdesk-tcp-21115]
type = tcp
local_ip = 127.0.0.1
local_port = 21115
remote_port = 21115


[rustdesk-tcp-21116]
type = tcp
local_ip = 127.0.0.1
local_port = 21116
remote_port = 21116


[rustdesk-udp-21116]
type = udp
local_ip = 127.0.0.1
local_port = 21116
remote_port = 21116


[rustdesk-tcp-21117]
type = tcp
local_ip = 127.0.0.1
local_port = 21117
remote_port = 21117


[rustdesk-tcp-21118]
type = tcp
local_ip = 127.0.0.1
local_port = 21118
remote_port = 21118


[rustdesk-tcp-21119]
type = tcp
local_ip = 127.0.0.1
local_port = 21119
remote_port = 21119
```

å¦‚æœæƒ³è®©**å†…ç½‘ä¸»æœºA**å¯ä»¥æ¥æ”¶å¤–ç½‘è¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†**å†…ç½‘ä¸»æœºA**çš„ID serverè®¾ç½®ä¸ºäº‘æœåŠ¡å™¨IPï¼ˆäº‘æœåŠ¡å™¨çš„IPä¸ºå…¬ç½‘IP, ä¼šæ¥æ”¶è¯·æ±‚ï¼Œå¹¶è½¬å‘åˆ°æ ‘è“æ´¾ï¼‰

ğŸŒˆIf you want **Host A in the intranet** to be able to receive connections from the extranet, we need to set the ID server of **Host A in the intranet** to the IP of the cloud server (the IP of the cloud server is a public IP, it will receive requests and forward them to the Raspberry Pi)

å½“ç„¶ï¼Œå¤–ç½‘å‘èµ·æ§åˆ¶çš„ä¸»æœºï¼Œä¹Ÿè¦è®¾ç½®å¤–ç½‘IP, æ‰èƒ½å‘èµ·æ§åˆ¶ã€‚

ğŸŒˆOf course, the host that initiates control from the external network also needs to set the external network IP in order to initiate control.

![image-20230912135153485](https://cdn.fangyuanxiaozhan.com/assets/1694497914409R6QyH826.png)

å¦‚æœ**å‘èµ·æ§åˆ¶ç«¯**åœ¨å®¶åº­å†…ç½‘ç¯å¢ƒä¸‹ï¼Œå¯ä»¥å°†**ID server** è®¾ç½®ä¸ºæ ‘è“æ´¾å†…ç½‘IPï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º**äº‘æœåŠ¡å™¨å…¬ç½‘IP**

ğŸŒˆIf the **control initiating end** is in a home intranet environment, the **ID server** can be set to the intranet IP of the Raspberry Pi, or it can be set to the **public IP of the cloud server**

## ç›´æ¥å°†rustdeskæœåŠ¡æ”¾åˆ°æœåŠ¡å™¨è¿è¡Œä¸å°±å¥½äº†ï¼Œä¸ºä½•è¦æ”¾åœ¨æ ‘è“æ´¾è¿è¡Œï¼Ÿ / Why Run Rustdesk Service on Raspberry Pi Instead of Directly on the Server?

rustdeskæœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œhbbsè´Ÿè´£éªŒè¯ç­¾åï¼Œhbbrè´Ÿè´£è½¬å‘è¿œç¨‹æ§åˆ¶äº§ç”Ÿçš„æ•°æ®åŒ…ã€‚

ğŸŒˆRustdesk has two services, hbbs is responsible for verifying signatures, and hbbr is responsible for forwarding data packets generated by remote control.

![170487506-8ef1f025-ad42-47f9-8d82-b49d0ec759ad](https://cdn.fangyuanxiaozhan.com/assets/1694498376154G7B1thhS.png)

æˆ‘ä»¬åœ¨è®¾ç½®ç•Œé¢ï¼Œåªå¡«å†™äº†hbbsä¿¡æ¯ï¼ˆID serverï¼‰ ï¼Œæ²¡æœ‰å¡«å†™hbbrä¿¡æ¯ï¼Œhbbrå°±ä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦èµ°å…¬ç½‘æµé‡ã€‚

ğŸŒˆIn the setting interface, we only filled in the hbbs information (ID server) and did not fill in the hbbr information. Hbbr will automatically determine whether to use public network traffic.

å¦‚æœæˆ‘ä»¬çš„**è¢«æ§ä¸»æœº**å’Œ**å‘èµ·æ§åˆ¶çš„ä¸»æœº**éƒ½åœ¨å†…ç½‘ï¼ŒäºŒè€…å°±ä¼šç›´æ¥èµ°å†…ç½‘æµé‡ï¼Œä½“éªŒå°†æ— æ¯”ä¸æ»‘ã€‚

ğŸŒˆIf our **controlled host** and the **host initiating control** are both in the intranet, the two will directly use the intranet traffic, and the experience will be incredibly smooth.

å½“ç„¶æ§åˆ¶ç«¯æˆ–è¢«æ§ç«¯ï¼Œä¸€æ—¦ç¦»å¼€äº†å†…ç½‘ï¼Œå°±è‡ªåŠ¨èµ°äº‘æœåŠ¡å™¨è½¬å‘æµé‡ã€‚

ğŸŒˆOf course, if the control end or the controlled end leaves the intranet, it will automatically use the cloud server to forward traffic.

![image-20230912141949102](https://cdn.fangyuanxiaozhan.com/assets/16944995908258GRFpifA.png)

## é‚£ID serveråˆ°åº•åº”è¯¥æ€ä¹ˆå¡«ï¼Ÿ / So How Should the ID Server be Filled?

åªè¦åœ¨å¤–ç½‘ï¼Œæ§åˆ¶ç«¯å’Œè¢«æ§ç«¯ï¼Œä¸€å¾‹å¡«å†™å¤–ç½‘IPï¼ 

ğŸŒˆAs long as it's on the external network, both control end and controlled end, fill in the external IP!

å¦‚æœåœ¨å†…ç½‘ï¼Œæ§åˆ¶ç«¯å’Œè¢«æ§ç«¯ï¼Œä¾ç„¶å¯ä»¥å…¨éƒ¨å¡«å†™å¤–ç½‘IPï¼›ï¼ˆå¦‚æœè¢«æ§ç«¯å’Œæ§åˆ¶ç«¯è®¾å¤‡åŒæ—¶åœ¨å†…ç½‘ï¼Œä¼šè‡ªåŠ¨èµ°å†…ç½‘æµé‡ï¼Œæ— æ¯”é¡ºæ»‘ï¼‰

ğŸŒˆIf it's in the intranet, the control end and the controlled end can still fill in the external IP; (If the controlled end and the control end device are in the intranet at the same time, it will automatically use intranet traffic, which is incredibly smooth)

å¦‚æœæŸå°è®¾å¤‡ï¼Œåªå¸Œæœ›è¢«å†…ç½‘çš„è®¾å¤‡è¿æ¥ï¼Œåˆ™å¡«å†™å†…ç½‘IP!

ğŸŒˆIf a device only wants to be connected by devices in the intranet, then fill in the intranet IP!

(å†…ç½‘IPæ˜¯æŒ‡æ ‘è“æ´¾IP, å¤–ç½‘IPæ˜¯æŒ‡äº‘æœåŠ¡å™¨IP)

ğŸŒˆ(Intranet IP refers to the Raspberry Pi IP, and the external network IP refers to the cloud server IP)

## å°ç»“ / Summary

æˆ‘çœ‹åˆ°æœ‰äº›youtuberæŠŠmac miniæ”¹æˆäº†å®¶åº­æœåŠ¡å™¨ï¼Œç”±äºmacOSå¯¹VNCåè®®çš„è´Ÿä¼˜åŒ–ï¼Œå¯¼è‡´ç”»é¢æ’•è£‚ï¼Œäºæ˜¯åªèƒ½æç€é¼»å­ç”¨sshè¿æ¥æœåŠ¡å™¨ï¼Œä½†æˆ‘æ„Ÿè§‰æ”¾å¼ƒmacOSé¡ºæ»‘çš„åŠ¨ç”»å¤ªå¯æƒœäº†, äºæ˜¯å°±æœ‰äº†æ ‘è“æ´¾è¿è¡Œå¼€æºrustdeskçš„æ–¹æ¡ˆã€‚

ğŸŒˆI've seen some YouTubers turn the Mac Mini into a home server. Due to macOS's poor optimization of the VNC protocol, the screen tears, so they can only connect to the server via SSH reluctantly. But I feel it's a pity to give up the smooth animation of macOS, so there's the solution of running the open-source Rustdesk on the Raspberry Pi.

è™½ç„¶æœ‰Teamviewer, ToDesk, å‘æ—¥è‘µç­‰æ–¹æ¡ˆï¼Œä½†éƒ½æ— æ³•å®ç°å†…ç½‘ä¸æ»‘æµç•…çš„è¿œç¨‹æ¡Œé¢ä½“éªŒã€‚

ğŸŒˆAlthough there are solutions like Teamviewer, ToDesk, Sunflower, etc., none of them can achieve a smooth and fluent remote desktop experience in the intranet.

è¿™ä¸ªæ ‘è“æ´¾rustdeskæ–¹æ¡ˆä¿è¯äº†è¿œç¨‹æ¡Œé¢å†…ç½‘ä¸æ»‘ï¼Œå¤–ç½‘æµç•…ï¼Œå³ä½¿æ²¡æœ‰æ ‘è“æ´¾ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è™šæ‹Ÿæœºè¿è¡ŒrustdeskæœåŠ¡å™¨å®ç°ï¼Œè®©è€æ—§çš„MacBookç„•å‘æµå…‰æº¢å½©ã€‚

ğŸŒˆThis Raspberry Pi Rustdesk solution ensures that the remote desktop is smooth in the intranet and fluent in the external network. Even without a Raspberry Pi, it can be implemented by running the Rustdesk server on a virtual machine, letting the old MacBook shine brightly.
---
title: ã€Šæ ‘è“æ´¾ä¸åƒç°ã€‹ç¬¬äºŒåä¸‰æœŸï¼šåœ¨æ ‘è“æ´¾æ­å»ºä¸ªäººæ‘„å½±ç«™ / ã€ŠUse Piã€‹Issue 23  Building a Personal Photography Website on Raspberry Pi
categories:
- æ ‘è“æ´¾ä¸åƒç° / Use Pi
---



æœ€è¿‘zhaooleeæ·»ç½®äº†ä¸€å°Sony ZV1 M2ï¼Œ å¡ç‰‡æœºå¾ˆå°å·§ï¼Œå¯ä»¥å¡åˆ°å…œé‡Œï¼Œå¤§å¤§æå‡äº†å‡ºç‰‡çš„é€Ÿåº¦ï¼Œä¸ºäº†å±•ç¤ºè¿™äº›ç…§ç‰‡ï¼Œæœ¬æœŸæˆ‘ä¼šæ­å»ºä¸€ä¸ªè¿è¡Œåœ¨æ ‘è“æ´¾çš„æ‘„å½±ç½‘ç«™ï¼ŒåŒæ—¶æ”¯æŒå¤–éƒ¨è®¿é—®ã€‚



ğŸŒˆRecently, zhaoolee added a Sony ZV1 M2 to his gear. This compact camera can be tucked into a pocket, greatly speeding up the process of taking pictures. To showcase these photos, I will build a photography website running on Raspberry Pi in this issue, which also supports external access.



![IMG_3759](https://cdn.fangyuanxiaozhan.com/assets/1698229043865acM8e0AP.jpeg)

![IMG_3759](https://cdn.fangyuanxiaozhan.com/assets/1698229069963zDTwZBZ4.jpeg)





åœ¨æ ‘è“æ´¾å­˜æ”¾çš„å¥½å¤„æ˜¯å¯ä»¥ç©ºé—´ä¾¿å®œï¼Œæœºæ¢°ç¡¬ç›˜1TBåªéœ€è¦å‡ åå—é’±ï¼Œå¦‚æœä½¿ç”¨å®¶åº­å†…ç½‘è®¿é—®ç½‘ç«™ï¼Œå³ä½¿æ˜¯è¶…å¤§çš„åŸå›¾ï¼Œä¹Ÿèƒ½ä»¥æå¿«é€Ÿåº¦æ‰“å¼€ã€‚

ğŸŒˆThe advantage of storing on Raspberry Pi is that the space is cheap, a 1TB mechanical hard drive only costs a few tens of dollars. If you access the website using the home intranet, even the super large original images can be opened at a very fast speed.

æ ‘è“æ´¾é€šè¿‡å†…ç½‘ç©¿é€ï¼Œä¹Ÿèƒ½å°†ç½‘ç«™å¼€æ”¾åˆ°äº’è”ç½‘ã€‚

ğŸŒˆThrough intranet penetration, Raspberry Pi can also open the website to the Internet.



æœ€ç»ˆæ•ˆæœ https://photography.v2fy.com/

ğŸŒˆFinal effect: https://photography.v2fy.com/

![image-20231017195700258](https://cdn.fangyuanxiaozhan.com/assets/1697543821305jEDkQTkc.png)

ç‚¹å‡»å›¾ç‰‡ï¼Œå¯ä»¥æ˜¾ç¤ºå¤§å›¾ï¼Œå®½å±æ¨¡å¼ä¸‹ï¼Œå¦‚æœåŸå›¾ä¿ç•™äº†æ‹æ‘„å‚æ•°ï¼Œå·¦ä¸‹è§’ä¼šæ˜¾ç¤º

ğŸŒˆClicking on the image will display a larger image. In wide screen mode, if the original image retains the shooting parameters, they will be displayed in the lower left corner.

![image-20231018123048480](https://cdn.fangyuanxiaozhan.com/assets/1697603449189XcA8JYC4.png)

![image-20231018123217978](https://cdn.fangyuanxiaozhan.com/assets/169760353851235ry4GW3.png)

![image-20231018123635558](https://cdn.fangyuanxiaozhan.com/assets/16976037960751Y144ikm.png)

![image-20231018123743026](https://cdn.fangyuanxiaozhan.com/assets/1697603863548yt503aWn.png)

æ‘„å½±ç½‘ç«™åŸºäºGithubå¼€æºé¡¹ç›® https://github.com/rampatra/photography ï¼Œå¼€æºé¡¹ç›®æ”¯æŒè¿è¡Œ`gulp resize`å¯¹æ‘„å½±å›¾ç‰‡è¿›è¡Œä¸€é”®è£å‰ªï¼Œè£å‰ªåå®½åº¦ä¸º1024pxçš„å›¾ç‰‡ä½œä¸ºåŸç‰‡æ”¾å…¥`images/full` æ–‡ä»¶å¤¹ï¼Œå®½åº¦512pxçš„ä½œä¸ºé¢„è§ˆå›¾ï¼Œæ”¾å…¥`images/thumbs`æ–‡ä»¶å¤¹ã€‚

ğŸŒˆThe photography website is based on the Github open-source project https://github.com/rampatra/photography. The open-source project supports running `gulp resize` to crop photography images with one click. After cropping, images with a width of 1024px are put into the `images/full` folder as originals, and those with a width of 512px are put into the `images/thumbs` folder as previews.

ä½†æˆ‘å¸Œæœ›`images/full` æ”¾çš„æ˜¯æœ€åŸå§‹çš„å›¾ç‰‡ï¼Œè¿è¡Œ`gulp resize` åï¼ŒåŸºäº`images/full`å†…çš„å›¾ç‰‡ç”Ÿæˆé¢„è§ˆå›¾ï¼Œæ”¾å…¥`images/thumbs`å³å¯ï¼Œ
äºæ˜¯æˆ‘é‡å†™äº†resizeè¿™æ®µé€»è¾‘ï¼Œä»£ç å­˜æ”¾åœ¨ https://github.com/zhaoolee/photography


ğŸŒˆHowever, I hope that the `images/full` folder contains the most original images. After running `gulp resize`, preview images based on the images in `images/full` are generated and put into `images/thumbs`. So, I rewrote the resize logic, and the code is stored at https://github.com/zhaoolee/photography




photography è¿™ä¸ªå¼€æºé¡¹ç›®æ˜¯é»˜è®¤åŸºäºGithub Actionsæ„å»ºï¼Œç„¶åä½¿ç”¨Github Pagesæ‰˜ç®¡é™æ€é¡µï¼Œå®Œæˆå‘å¸ƒã€‚ä½†æ˜¯åœ¨ä¸­å›½ï¼ŒGithub Pagesçš„å›¾ç‰‡èµ„æºè¢«ç‰¹è‰²ç½‘ç»œæå¾—æ— æ³•è®¿é—®ã€‚

ğŸŒˆThe open-source project photography is by default built based on Github Actions and then uses Github Pages to host static pages to complete the release. However, in China, the image resources of Github Pages are made inaccessible by the special network.

ä¸ºäº†åº”å¯¹ç‰¹è‰²ç½‘ç»œç¯å¢ƒï¼Œæˆ‘æŠŠé¡¹ç›®æ”¹é€ æˆäº†ï¼šé¡¹ç›®ä¾ç„¶æ‰˜ç®¡åœ¨Githubï¼Œä½†åœ¨æœ¬åœ°å®Œæˆé™æ€ç½‘ç«™çš„æ„å»ºï¼Œå°†æ„å»ºå®Œæˆçš„é™æ€ç½‘ç«™èµ„æºï¼Œé€šè¿‡rsyncå‘é€åˆ°æ ‘è“æ´¾ç‰¹å®šæ–‡ä»¶å¤¹ï¼Œå°±å®Œæˆäº†éƒ¨ç½²ã€‚åŒæ—¶å°†é¡¹ç›®èµ„æºå‘å¸ƒåˆ°Githubä»“åº“ä½œä¸ºå¤‡ä»½ã€‚


ğŸŒˆIn order to cope with the special network environment, I transformed the project: the project is still hosted on Github, but the static website is built locally. The built static website resources are sent to a specific folder on the Raspberry Pi via rsync to complete the deployment. At the same time, the project resources are published to the Github repository as a backup.

å¦å¤–æˆ‘è¿˜åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå°†å›¾ç‰‡æ”¾å…¥fullsæ–‡ä»¶å¤¹ï¼Œå³å¯å®æ—¶è‡ªåŠ¨ç”Ÿæˆé¢„è§ˆå›¾ï¼Œå¹¶å®æ—¶å±•ç¤ºåˆ°ç½‘é¡µä¸Šï¼ŒåŸç‰ˆéœ€è¦æ‰‹åŠ¨è¿è¡Œ `gulp resize`

ğŸŒˆIn addition, I made some optimizations. By putting the images into the fulls folder, preview images can be generated in real time and displayed on the webpage in real time. In the original version, you need to manually run `gulp resize`.

å®é™…æ“ä½œèµ·æ¥ï¼Œåªéœ€å°†å›¾ç‰‡æ”¾å…¥`images/fulls`æ–‡ä»¶å¤¹ï¼Œè¿è¡Œ`npm run push` , å°±å®Œæˆäº†å‘å¸ƒï¼Œå¹¶åœ¨Githubåšå¥½äº†å¤‡ä»½ã€‚

ğŸŒˆIn practice, you just need to put the pictures into the `images/fulls` folder and run `npm run push` to complete the publication, and the backup is done on Github.

## è·å–é¡¹ç›®, å®‰è£…ä¾èµ– / Get the Project, Install Dependencies

```
git clone --depth=1 https://github.com/zhaoolee/photography.git
cd photography
bundle install
npm install
```



## è¿è¡Œé¡¹ç›® / Run the Project

```
npm run dev
```

æµè§ˆå™¨æ‰“å¼€`http://127.0.0.1:4000` ï¼Œ å°±èƒ½çœ‹åˆ°zhaooleeçš„æ‘„å½±ç½‘ç«™å±•ç¤ºèµ„æºï¼Œåˆ é™¤`images/fulls` å’Œ`images/thumbs` å†…çš„å›¾ç‰‡èµ„æºï¼Œå°†è‡ªå·±çš„å›¾ç‰‡æ”¾åˆ°`images/fulls` åˆ·æ–°æµè§ˆå™¨å³å¯çœ‹åˆ°æœ€ç»ˆæ•ˆæœ


ğŸŒˆOpen `http://127.0.0.1:4000` in the browser, and you can see the resources displayed on zhaoolee's photography website. Delete the image resources in `images/fulls` and `images/thumbs`, put your own pictures into `images/fulls`, refresh the browser, and you can see the final effect.

## ç”Ÿæˆé™æ€ç½‘ç«™ / Generate Static Website

```
npm run build
```

è¿è¡Œä»¥ä¸Šå‘½ä»¤åï¼Œä¼šåœ¨æ ¹ç›®å½•çš„`_site`æ–‡ä»¶å¤¹ç”Ÿæˆç½‘ç«™æ‰€éœ€çš„å…¨éƒ¨èµ„æºã€‚

ğŸŒˆAfter running the above command, all the resources needed by the website will be generated in the `_site` folder in the root directory.

![image-20231018150456563](https://cdn.fangyuanxiaozhan.com/assets/1697612697190ae0jnWFN.png)

åªè¦å°†`_site`ä¸‹é¢çš„å†…å®¹æ‰˜ç®¡ç»™æ ‘è“æ´¾çš„nginxå°±èƒ½å¯¹å†…ç½‘è®¿é—®äº†ã€‚


ğŸŒˆAs long as the content under `_site` is hosted by the Raspberry Pi's nginx, it can be accessed on the intranet.

åœ¨Nginxåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºå­˜å‚¨`_site`çš„é™æ€å†…å®¹

ğŸŒˆCreate a directory in Nginx to store the static content of `_site`.

```
sudo mkdir /usr/share/nginx/photography.v2fy.com
sudo chown www-data:www-data /usr/share/nginx/photography.v2fy.com
```

ç”±äºnginxé»˜è®¤çš„ç”¨æˆ·ä¸º`www-data`, æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå±äº`www-data` çš„æ–‡ä»¶å¤¹ï¼Œä¾›Nginxä½¿ç”¨

ğŸŒˆSince the default user of nginx is `www-data`, we create a folder belonging to `www-data` for Nginx to use.

![image-20231018151304146](https://cdn.fangyuanxiaozhan.com/assets/1697613184538kr7XY2cf.png)



åœ¨æ ‘è“æ´¾çš„`etc/nginx/conf.d` ç›®å½•ä¸‹æ–°å»ºä»¥`.conf` ç»“å°¾çš„æ–‡ä»¶ï¼Œæ¯”å¦‚`photography.v2fy.com.conf`, å¹¶æ”¾å…¥ä»¥ä¸‹å†…å®¹

ğŸŒˆIn the `etc/nginx/conf.d` directory of the Raspberry Pi, create a new file ending with `.conf`, such as `photography.v2fy.com.conf`, and put the following content into it.



```
server {
    listen 8084;
    server_name photography.v2fy.com 127.0.0.1  192.168.50.10;

    location / {
        root /usr/share/nginx/photography.v2fy.com;
        index index.html index.htm;
        try_files $uri $uri/ =404;
    }

    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
```



ç„¶åä½¿ç”¨rsyncå°†`_site` çš„å†…å®¹ä¼ è¾“åˆ°`/usr/share/nginx/photography.v2fy.com`ï¼Œ å‘½ä»¤ç¤ºä¾‹


ğŸŒˆThen use rsync to transfer the content of `_site` to `/usr/share/nginx/photography.v2fy.com`. Here is a command example.

```
rsync -avvz --update --no-perms --chown=www-data:www-data --delete ./_site/  root@frp:/usr/share/nginx/photography.v2fy.com/
```

ä¼ è¾“å®Œæˆåï¼Œé‡å¯nginx


ğŸŒˆAfter the transfer is completed, restart nginx.

```
sudo nginx -t
sudo nginx -s reload
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½‘è®¿é—®å½±è§†ç«™äº†

ğŸŒˆWe can now access the photography website on the intranet.

![image-20231018151723132](https://cdn.fangyuanxiaozhan.com/assets/1697613443960ysnTQj3i.png)

åœ¨æ ‘è“æ´¾çš„frpc.iniæ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œå°†æœ¬åœ°çš„8084æ˜ å°„åˆ°äº‘æœåŠ¡å™¨çš„8084

ğŸŒˆAdd the following configuration to the frpc.ini of the Raspberry Pi to map the local 8084 to the 8084 of the cloud server.

```
[photography]
type = tcp
local_ip = 127.0.0.1
local_port = 8084
remote_port = 8084
```

åœ¨æœåŠ¡ç«¯Nginxé…ç½®è§„åˆ™æ–‡ä»¶`/etc/nginx/conf.d/photography.v2fy.com.conf`


ğŸŒˆConfigure the rule file `/etc/nginx/conf.d/photography.v2fy.com.conf` on the server-side Nginx.

```
upstream photography_v2fy_com { server 127.0.0.1:8084; }

server {
    server_name      photography.v2fy.com;
    listen           80;

    #rewrite ^(.*)$ https://$host$1 permanent;

    location / {
        proxy_pass http://photography_v2fy_com;
        proxy_set_header Host $host:80;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

server {
    listen       443 ssl http2;
    listen       [::]:443 ssl http2;
    server_name  photography.v2fy.com;

    location / {
        proxy_pass http://photography_v2fy_com;
        proxy_set_header Host $host:443;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    ssl_certificate "/etc/nginx/ssl/photography.v2fy.com/fullchain.cer";
    ssl_certificate_key "/etc/nginx/ssl/photography.v2fy.com/photography.v2fy.com.key";
    ssl_session_cache shared:SSL:1m;
    ssl_session_timeout  10m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # Load configuration files for the default server block.

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }
}
```
è¯ä¹¦é…ç½®å®Œæˆåï¼Œé‡å¯æœåŠ¡ç«¯Nginxå³å¯ï¼

ğŸŒˆAfter the certificate configuration is completed, restart the server-side Nginx!

![image-20231018153742966](https://cdn.fangyuanxiaozhan.com/assets/1697614663750xc8J2YYK.png)


## å°ç»“ / Summary


éšç€æ‰‹æœºæ‘„å½±è¶Šæ¥è¶Šå¼ºï¼Œç›¸æœºå‚å•†ä¹Ÿè¶Šæ¥è¶Šå·ï¼Œè€Œæ¶ˆè´¹è€…å¤§é‡è´­ä¹°ï¼Œä¹Ÿä¼šæ‘Šè–„ç ”å‘æˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¾ˆä½çš„ä»·é’±ï¼Œä¹°åˆ°å¾ˆæ£’çš„ç›¸æœºï¼Œäº«å—æ‘„å½±çš„ä¹è¶£ï¼Œè€Œæ ‘è“æ´¾æ‘„å½±ç½‘ç«™ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä»¥æä½çš„æˆæœ¬ï¼Œå°†è‡ªå·±çš„ä½œå“å±•ç¤ºåˆ°äº’è”ç½‘ã€‚

ğŸŒˆAs mobile phone photography becomes stronger and camera manufacturers become more competitive, the large number of consumers buying also dilutes the cost of research and development. We can buy great cameras at a very low price and enjoy the fun of photography. The Raspberry Pi photography website allows us to showcase our works on the Internet at a very low cost.



å¦‚æœä½ æ˜¯ä¸€ä¸ªçƒ­çˆ±æ‘„å½±çš„äººï¼Œç‹¬ç«‹çš„æ‘„å½±ç½‘ç«™ï¼Œèƒ½ä¸ºä½ çš„çˆ±å¥½å¢åŠ å‡ åˆ†ä¸“ä¸šï¼ŒåšæŒæ›´æ–°è‡ªå·±çš„æ‘„å½±ç½‘ç«™ï¼Œå­¦ä¹ æ‘„å½±ï¼ŒæŸ¥çœ‹ä»¥å¾€çš„ç…§ç‰‡ï¼Œä¹Ÿèƒ½å¯¹æ‘„å½±æœ‰æ›´å¤šçš„æ€è€ƒã€‚

ğŸŒˆIf you are a person who loves photography, an independent photography website can add a few points of professionalism to your hobby. Persist in updating your own photography website, learn photography, view past photos, and you can have more thoughts about photography.